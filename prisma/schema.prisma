// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  GUIDE
  CLIENT
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  username  String?  @unique
  password  String
  name      String
  role      UserRole @default(CLIENT)
  phone     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  downwindersCreated Downwinder[] @relation("CreatedBy")
  bookings          Booking[]
  assignedDownwinders DownwinderGuide[] @relation("GuideAssignments")

  @@map("users")
}

model Spot {
  id          String   @id @default(uuid())
  name        String
  description String?
  location    String
  latitude    Float?
  longitude   Float?
  difficulty  String?  // e.g., "Beginner", "Intermediate", "Advanced"
  conditions  String?  // e.g., wind conditions, best season
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  downwinders DownwinderSpot[]

  @@map("spots")
}

model Hotel {
  id          String   @id @default(uuid())
  name        String
  description String?
  address     String
  phone       String?
  email       String?
  rating      Int?     @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  downwinders Downwinder[]

  @@map("hotels")
}

model Downwinder {
  id          String   @id @default(uuid())
  title       String
  description String?
  startDate   DateTime
  endDate     DateTime
  status      String   @default("draft") // draft, confirmed, completed, cancelled
  maxClients  Int      @default(10)
  
  // Relations
  createdById String
  createdBy   User   @relation("CreatedBy", fields: [createdById], references: [id])
  
  hotelId     String?
  hotel       Hotel?  @relation(fields: [hotelId], references: [id])
  
  spots       DownwinderSpot[]
  bookings    Booking[]
  guides      DownwinderGuide[] @relation("GuideAssignments")
  logistics   Logistics[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("downwinders")
}

model DownwinderSpot {
  id           String    @id @default(uuid())
  downwinderId String
  downwinder   Downwinder @relation(fields: [downwinderId], references: [id], onDelete: Cascade)
  spotId       String
  spot         Spot      @relation(fields: [spotId], references: [id], onDelete: Cascade)
  order        Int       @default(0) // Order of spots in the tour
  notes        String?

  @@unique([downwinderId, spotId])
  @@map("downwinder_spots")
}

model DownwinderGuide {
  id           String    @id @default(uuid())
  downwinderId String
  downwinder   Downwinder @relation("GuideAssignments", fields: [downwinderId], references: [id], onDelete: Cascade)
  guideId      String
  guide        User      @relation("GuideAssignments", fields: [guideId], references: [id], onDelete: Cascade)
  role         String?   // e.g., "lead", "tail", "support"
  notes        String?

  @@unique([downwinderId, guideId])
  @@map("downwinder_guides")
}

model Booking {
  id           String   @id @default(uuid())
  downwinderId String
  downwinder   Downwinder @relation(fields: [downwinderId], references: [id], onDelete: Cascade)
  clientId     String
  client       User     @relation(fields: [clientId], references: [id], onDelete: Cascade)
  status       String   @default("pending") // pending, confirmed, cancelled, completed
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([downwinderId, clientId])
  @@map("bookings")
}

enum LogisticsType {
  CAR
  TRANSFER
  FOOD
  BOAT_SUPPORT
  QUAD_BIKE
  OTHER
}

model Logistics {
  id           String         @id @default(uuid())
  downwinderId String
  downwinder   Downwinder     @relation(fields: [downwinderId], references: [id], onDelete: Cascade)
  type         LogisticsType
  name         String         // e.g., "Van 1", "Support Boat", "Lunch Service"
  description  String?
  quantity     Int            @default(1)
  cost         Float?
  provider     String?        // Company or person providing the service
  contactInfo  String?
  status       String         @default("pending") // pending, confirmed, cancelled
  startDate    DateTime?
  endDate      DateTime?
  notes        String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  @@map("logistics")
}